<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login & Register</title>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"/>

  <!-- Font Awesome for eye icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <style>
    * { font-family: Consolas, Monaco, monospace; }

    body, html {
      height: 100%;
      margin: 0;
      background-color: #f0f2f5;
      transition: background-color 0.6s ease-in-out;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 40px;
      background-color: #232f3e;
      color: white;
      border-bottom: 3px solid #ffa500;
    }

    .header img { max-width: 120px; }

    .auth-container {
      width: 800px;
      height: 500px;
      margin: 50px auto 0;
      display: flex;
      background-color: white;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      border-radius: 10px;
      overflow: hidden;
      position: relative;
      transition: background-color 0.6s ease-in-out;
    }

    .form-container {
      width: 50%;
      padding: 40px;
      background-color: #f8f9fa;
      transition: all 0.6s ease-in-out;
    }

    .form-container form { display: flex; flex-direction: column; }

    .form-container input {
      margin-bottom: 15px;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ddd;
    }

    .form-container button {
      padding: 10px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      background-color: #232F3E;
      color: white;
    }

    .switch-overlay {
      position: absolute;
      top: 0;
      left: 50%;
      width: 50%;
      height: 100%;
      background-color: #ffa500;
      transition: all 0.6s ease-in-out;
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      user-select: none;
    }
    .switch-overlay.active { left: 0; }

    .custom-alert {
      border-radius: 8px;
      font-size: 16px;
      padding: 15px 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
      background-color: #fff;
      border-left: 5px solid #dc3545;
      color: #721c24;
      transition: opacity 0.5s ease-in-out;
    }
    .alert-danger { background-color: #f8d7da; border-color: #f5c6cb; color: #721c24; }

    .password-wrapper { position: relative; }
    .password-wrapper input { width: 100%; padding-right: 40px; }
    .toggle-password {
      position: absolute; top: 50%; right: 10px; transform: translateY(-50%);
      cursor: pointer; color: #888;
    }

    @media (max-width: 768px) {
      .auth-container {
        flex-direction: column; width: 95%; height: auto; margin-top: 20px;
      }
      .form-container { width: 100%; padding: 30px 20px; display: none; }
      .form-container.active { display: block; }

      .switch-overlay {
        position: relative; width: 100%; height: auto; left: 0; top: 0; transform: none;
        padding: 15px; font-size: clamp(18px, 4vw, 22px);
        border-top: 1px solid #ccc; border-radius: 0 0 10px 10px;
      }

      .header { flex-direction: column; text-align: center; padding: 20px; }
      .header img { max-width: 100px; }
      .hamburger { margin-top: 10px; }
    }
  </style>
</head>
<body>

<!-- Header -->
<header class="header">
  <a href="{{ url_for('home') }}">
    <img src="{{ url_for('static', filename='logo.png') }}" alt="Helpdesk Logo"/>
  </a>
  <div class="hamburger" onclick="toggleNav()" aria-label="Toggle navigation">
    <div class="bar"></div><div class="bar"></div><div class="bar"></div>
  </div>
</header>

<!-- Flash messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
<div class="container mt-4">
  {% for category, message in messages %}
  <div class="alert alert-{{ category }} alert-dismissible fade show custom-alert" role="alert">
    <i class="fas fa-exclamation-circle mr-2"></i> {{ message }}
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  {% endfor %}
</div>
{% endif %}
{% endwith %}

<!-- Auth Container -->
<div class="auth-container" id="authContainer">

  <!-- Login -->
  <div class="form-container login-container active" id="loginContainer">
    <h2>Login</h2>
    <form action="{{ url_for('login') }}" method="POST">
      <label class="sr-only" for="username">Username</label>
      <input type="text" id="username" name="username" placeholder="Username" required/>

      <div class="password-wrapper">
        <label class="sr-only" for="password">Password</label>
        <input type="password" id="password" name="password" placeholder="Password" required/>
        <i class="fa fa-eye toggle-password" onclick="togglePassword(this, 'password')" aria-label="Toggle password visibility" role="button" tabindex="0"></i>
      </div>

      <button type="submit">Login</button>

      <!-- Forgot password link -->
      <div class="mt-2 text-right">
        <a href="{{ url_for('forgot_password') }}" class="small">Forgot your password?</a>
      </div>
    </form>
  </div>

  <!-- Register -->
  <div class="form-container register-container" id="registerContainer" aria-hidden="true">
    <h2>Register</h2>
    <form id="registerForm" action="{{ url_for('register') }}" method="POST">
      <label class="sr-only" for="regUsername">Username</label>
      <input
        type="text" id="regUsername" name="username" placeholder="Username"
        pattern="^[a-zA-Z0-9]{8,16}$"
        title="Username must be 8-16 characters with no special characters" required/>

      <label class="sr-only" for="email">Email</label>
      <input type="email" id="email" name="email" placeholder="Email" required/>

      <div class="password-wrapper">
        <label class="sr-only" for="regPassword">Password</label>
        <input
          type="password" id="regPassword" name="password" placeholder="Password"
          pattern=".{8,}" title="Password must be at least 8 characters long" required/>
        <i class="fa fa-eye toggle-password" onclick="togglePassword(this, 'regPassword')" aria-label="Toggle password visibility" role="button" tabindex="0"></i>
      </div>

      <div class="password-wrapper">
        <label class="sr-only" for="confirmPassword">Confirm Password</label>
        <input
          type="password" id="confirmPassword" name="confirm_password" placeholder="Confirm Password"
          title="Passwords must match" required
          oninput="this.setCustomValidity(this.value !== document.getElementById('regPassword').value ? 'Passwords do not match.' : '')"/>
        <i class="fa fa-eye toggle-password" onclick="togglePassword(this, 'confirmPassword')" aria-label="Toggle password visibility" role="button" tabindex="0"></i>
      </div>

      <button type="submit">Register</button>
    </form>
  </div>

  <!-- Switch Overlay -->
  <div class="switch-overlay" id="switchOverlay" onclick="switchForms()">Register</div>
</div>

<!-- Scripts -->
<script>
  function toggleNav(){ /* placeholder to avoid errors when clicking hamburger */ }

  function switchForms() {
    const loginContainer = document.getElementById('loginContainer');
    const registerContainer = document.getElementById('registerContainer');
    const switchOverlay = document.getElementById('switchOverlay');

    if (window.innerWidth <= 768) {
      loginContainer.classList.toggle('active');
      registerContainer.classList.toggle('active');
      registerContainer.setAttribute('aria-hidden', !registerContainer.classList.contains('active'));
    }
    switchOverlay.classList.toggle('active');
    switchOverlay.textContent = switchOverlay.textContent === 'Login' ? 'Register' : 'Login';
  }

  function togglePassword(icon, inputId) {
    const input = document.getElementById(inputId);
    if (!input) return;
    const isPwd = input.type === "password";
    input.type = isPwd ? "text" : "password";
    icon.classList.toggle("fa-eye", !isPwd);
    icon.classList.toggle("fa-eye-slash", isPwd);
  }

  // Keep confirm field validity in sync if the main password changes
  (function () {
    var p = document.getElementById('regPassword');
    var c = document.getElementById('confirmPassword');
    if (p && c) {
      p.addEventListener('input', function () {
        if (c.value) {
          c.setCustomValidity(c.value !== p.value ? 'Passwords do not match.' : '');
        }
      });
    }
  })();
</script>

<!-- jQuery and Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" crossorigin="anonymous"></script>

</body>
</html>
